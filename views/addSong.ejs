<% layout('layouts/boilerplate') %>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">

<style>
  .button-add-song {
    border: 2px solid black;
    font-weight: 500;
    color: #333;
  }

  .form-control {
    background-color: #f2f2f2;
    color: black;
    border: none;
  }

  .form-control:hover {
    background-color: #e6e6e6;
  }

  h1, h4 {
    padding-bottom: 20px;
  }

  h1 {
    font-family: 'Roboto', sans-serif;
    font-weight: 300;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  }

  h4 {
    font-family: 'Roboto', sans-serif;
    font-style: italic;
    letter-spacing: 1px;
    color: #555;
  }
</style>

<div class="row">
  <h1 class="text-left pl-4">New Song</h1>
  <h4 class="text-left font-weight-bold font-italic text-dark pl-4">Please fill out required fields.</h4>

  <div class="col-6 pl-4">
    <form id="add-song-form">
      <label class="form-label" for="title">Title<span style="color: black">*</span>:</label><br>
      <div class="mb-3">
        <input class="form-control" type="text" id="title" name="title" required>
      </div>

      <label class="form-label" for="singerOrType">Singer/Type<span style="color: black">*</span>:</label><br>
      <div class="mb-3">
        <input class="form-control" type="text" id="singerOrType" name="singerOrType" required>
      </div>

      <!-- ... -->

      <label class="form-label" for="theme">Theme<span style="color: black">*</span>:</label><br>
      <div class="mb-3">
        <select id="theme" class="form-control" name="theme" required>
          <option value="">Select a Theme</option>
          <option value="Fidelity">Fidelity</option>
          <option value="Hope">Hope</option>
          <!-- ... -->
          <option value="Christmas">Christmas</option>
        </select>
      </div>
      <!-- ... -->

      <label class="form-label" for="lyrics">Lyrics<span style="color: black">*</span>:</label><br>
      <div class="mb-3">
        <textarea class="form-control" id="lyrics" name="lyrics" required></textarea>
      </div>

      <label class="form-label" for="language">Language<span style="color: black">*</span>:</label><br>
      <div class="mb-3">
        <input class="form-control" type="text" id="language" name="language" required>
      </div>

      <label class="form-label" for="youtube_link">YouTube Link:</label><br>
      <div class="mb-3">
        <input class="form-control" type="text" id="youtube_link" name="youtube_link">
      </div>

      <label class="form-label" for="spotify_link">Spotify Link:</label><br>
      <div class="mb-3">
        <input class="form-control" type="text" id="spotify_link" name="spotify_link">
      </div>

      <label class="form-label" for="original_artist">Original Artist:</label><br>
      <div class="mb-3">
        <input class="form-control" type="text" id="original_artist" name="original_artist">
      </div>

      <div class="mb-3">
        <button class="btn btn-outline-dark text-dark button-add-song">Add Song</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.querySelector('#add-song-form').addEventListener('submit', async (event) => {
    event.preventDefault();

    const youtubeLinkInput = document.getElementById('youtube_link');
    const spotifyLinkInput = document.getElementById('spotify_link');

    const youtubeLink = youtubeLinkInput.value.trim();
    const spotifyLink = spotifyLinkInput.value.trim();

    const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)\S+$/;
    const spotifyRegex = /^(https?:\/\/)?(www\.)?open\.spotify\.com\/track\/\S+$/;

    let isValid = true;

    if (youtubeLink !== '' && !youtubeRegex.test(youtubeLink)) {
      isValid = false;
      alert('Please enter a valid YouTube link');
      youtubeLinkInput.focus();
    }

    if (spotifyLink !== '' && !spotifyRegex.test(spotifyLink)) {
      isValid = false;
      alert('Please enter a valid Spotify link');
      spotifyLinkInput.focus();
    }

    if (isValid) {
      const formData = new FormData(event.target);

      const response = await fetch('/songs', {
        method: 'POST',
        body: new URLSearchParams([...formData]),
      });

      if (response.ok) {
        window.location.href = '/songs/success';
      } else {
        alert('Error adding song');
      }
    }
  });
</script>
